{% extends "layout.html" %}
{% block content %}

<!-- Bootstrap Nav Tabs -->
<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="tempExcl-tab" data-toggle="tab" href="#tempExcl" role="tab" aria-controls="tempExcl" aria-selected="true">
      Temp Exclusions
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="versionedDirs-tab" data-toggle="tab" href="#versionedDirs" role="tab" aria-controls="versionedDirs" aria-selected="false">
      Versioned Directories
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="searchPath-tab" data-toggle="tab" href="#searchPath" role="tab" aria-controls="searchPath" aria-selected="false">
      Path Search
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="download-tab" data-toggle="tab" href="#download" role="tab" aria-controls="download" aria-selected="false">
      Download Files
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="localFs-tab" data-toggle="tab" href="#localFs" role="tab" aria-controls="localFs" aria-selected="false">
      Local FS Usage
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="hdfsUsage-tab" data-toggle="tab" href="#hdfsUsage" role="tab" aria-controls="hdfsUsage" aria-selected="false">
      HDFS Usage
    </a>
  </li>
</ul>

<div class="tab-content" id="myTabContent">
  <!-- Temp Exclusions -->
  <div class="tab-pane fade show active p-3" id="tempExcl" role="tabpanel" aria-labelledby="tempExcl-tab">
    <h4>Temp Exclusions (HDFS / Local)</h4>
    <form action="{{ url_for('add_temp_exclusions') }}" method="POST">
      <div class="form-group">
        <label>Mode:</label>
        <select name="mode" class="form-control">
          <option value="hdfs">HDFS</option>
          <option value="local">LOCAL</option>
        </select>
      </div>
      <div class="form-group">
        <label>Paths to Append (one per line):</label>
        <textarea name="exclusionLines" rows="5" class="form-control"></textarea>
      </div>
      <button type="submit" class="btn btn-primary">Add to Temp Exclusions</button>
    </form>
  </div>

  <!-- Versioned Directories -->
  <div class="tab-pane fade p-3" id="versionedDirs" role="tabpanel" aria-labelledby="versionedDirs-tab">
    <h4>Versioned Directories (HDFS / Local)</h4>
    <form action="{{ url_for('add_versioned_directories') }}" method="POST">
      <div class="form-group">
        <label>Mode:</label>
        <select name="mode" class="form-control">
          <option value="hdfs">HDFS</option>
          <option value="local">LOCAL</option>
        </select>
      </div>
      <div class="form-group">
        <label>Directories to Append (one per line):</label>
        <textarea name="versionedLines" rows="5" class="form-control"></textarea>
      </div>
      <button type="submit" class="btn btn-primary">Add to Versioned Directories</button>
    </form>
  </div>

  <!-- Path Search -->
  <div class="tab-pane fade p-3" id="searchPath" role="tabpanel" aria-labelledby="searchPath-tab">
    <h4>Search Path in a File</h4>
    <form action="{{ url_for('search_path') }}" method="POST">
      <div class="form-group">
        <label>Mode:</label>
        <select name="mode" class="form-control">
          <option value="hdfs">HDFS</option>
          <option value="local">LOCAL</option>
        </select>
      </div>
      <div class="form-group">
        <label>File Type:</label>
        <select name="fileType" class="form-control">
          <option value="temp">Temp Exclusions</option>
          <option value="versioned">Versioned Dirs</option>
        </select>
      </div>
      <div class="form-group">
        <label>Search Term (Exact):</label>
        <input type="text" name="searchTerm" class="form-control" />
      </div>
      <button type="submit" class="btn btn-primary">Search</button>
    </form>
  </div>

  <!-- Download Files -->
  <div class="tab-pane fade p-3" id="download" role="tabpanel" aria-labelledby="download-tab">
    <h4>Download a File (as ZIP)</h4>
    <form action="{{ url_for('download_file') }}" method="GET">
      <div class="form-group">
        <label>Mode:</label>
        <select name="mode" class="form-control">
          <option value="hdfs">HDFS</option>
          <option value="local">LOCAL</option>
        </select>
      </div>
      <div class="form-group">
        <label>File Type:</label>
        <select name="fileType" class="form-control">
          <option value="temp">Temp Exclusions</option>
          <option value="versioned">Versioned Dirs</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary">Download ZIP</button>
    </form>
  </div>

  <!-- Local FS Usage -->
  <div class="tab-pane fade p-3" id="localFs" role="tabpanel" aria-labelledby="localFs-tab">
    <h4>Local Filesystem Usage</h4>
    <p>Below is usage info for the configured mount points:</p>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Mount Point</th>
          <th>Size</th>
          <th>Used</th>
          <th>Avail</th>
          <th>Use%</th>
        </tr>
      </thead>
      <tbody>
        {% for mp, size, used, avail, pct in local_fs_usage %}
          <tr>
            <td>{{ mp }}</td>
            <td>{{ size }}</td>
            <td>{{ used }}</td>
            <td>{{ avail }}</td>
            <td>{{ pct }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- HDFS Usage -->
  <div class="tab-pane fade p-3" id="hdfsUsage" role="tabpanel" aria-labelledby="hdfsUsage-tab">
    <h4>HDFS Usage</h4>
    {% if hdfs_usage_data %}
      <p><strong>Location:</strong> {{ hdfs_usage_data.location }}</p>
      <p><strong>Namespace Quota:</strong> {{ hdfs_usage_data.ns_quota }}</p>
      <p><strong>Namespace Used:</strong> {{ hdfs_usage_data.ns_used }}</p>
      <p><strong>Namespace % Used:</strong> {{ hdfs_usage_data.ns_pct }}%</p>
      <p><strong>Space Quota (GB):</strong> {{ hdfs_usage_data.space_quota }}</p>
      <p><strong>Space Used (GB):</strong> {{ hdfs_usage_data.space_used }}</p>
      <p><strong>Space % Used:</strong> {{ hdfs_usage_data.space_pct }}%</p>
    {% else %}
      <p>Could not fetch HDFS usage data. Check logs or config.</p>
    {% endif %}
  </div>
</div>

{% endblock %}
